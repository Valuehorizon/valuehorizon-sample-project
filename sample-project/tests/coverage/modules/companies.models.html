<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Strict//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-strict.dtd">
<html xmlns="http://www.w3.org/1999/xhtml" xml:lang="en" lang="en">
  <head>
    <meta http-equiv="Content-type" content="text/html;charset=UTF-8" />
    <title>Test coverage report: companies.models</title>
    <style type="text/css" media="screen">
      a
      {
        color: #3d707a;
      }
      
      a:hover, a:active
      {
        color: #bf7d18;
      }
    
      body 
      {
        font-family: "Lucida Sans Unicode", "Lucida Grande", sans-serif;
        font-size: 13px;
      }
      
      .nav 
      {
        font-size: 12px;
        margin-left: 50px;
      }

      .ignored
      {
        color: #707070;
      }

      .executed 
      {
        color: #3d9900;
      }

      .missed 
      {
        color: red;
        font-weight: bold;
      }

      .excluded 
      {
        color: #6090f0;
        font-weight: lighter;
      }
    
      #content-header 
      {
        font-size: 12px;
        padding: 18px 0 18px 50px;
      }

      #content-header h1 
      {
        font-size: 16px;
        margin: 10px 0 0 0;
        color: #909090;
      }
      
      #module-name
      {
        color: #583707;
      }
    
      #content-header p
      {
        font-size: 13px;
        margin: 0;
        color: #909090;
      }

      #content-header .normal 
      {
        color: #609030;
      }

      #content-header .warning 
      {
        color: #d0a000;
      }

      #content-header .critical 
      {
        color: red;
      }
      
      #source-listing 
      {
        margin-bottom: 24px;
      }

      #source-listing ol 
      {
        padding: 0 0 0 50px;
        width: 90%;
        font-family: monospace;
        list-style-position: outside;
      }

      #source-listing ol li 
      {
        line-height: 18px;
        font-size: small;
      }
        
      #source-listing ol code 
      {
        padding:  0 .001em 0 0; /* Firefox doesn't render empty li's properly */
        font-size: medium;
        white-space: pre;
      }
   </style>
  </head>

  <body>

<div class="nav">
  <a href="companies.__init__.html">companies.__init__</a> &lt;&lt;
  <a href="../index.html">index</a>
</div>

<div id="content-header">
  <h1>
    <span id="module-name">companies.models</span>:
    265 total statements,
    <span class="warning">64.2% covered</span>
  </h1>
  <p>Generated: Mon 2015-09-28 13:52 AST</p>
  <p>Source file: /home/quincy/Code/valuehorizon-companies/companies/models.py</p>
  <p>
    Stats:
    <span class="executed">149 executed</span>,
    <span class="missed">83 missed</span>,
    <span class="excluded">33 excluded</span>,
    <span class="ignored">249 ignored</span> 
  </p> 
</div>

<div id="source-listing">
  <ol>
    <li class="ignored"><code># Import Django libraries</code></li>
<li class="excluded"><code>from django.db import models</code></li>
<li class="excluded"><code>from django.db import models</code></li>
<li class="excluded"><code>from django.utils.text import slugify</code></li>
<li class="excluded"><code>from django.core.validators import MaxLengthValidator</code></li>
<li class="ignored"><code></code></li>
<li class="ignored"><code># Import Valuehorizon libraries</code></li>
<li class="excluded"><code>from countries.models import Country</code></li>
<li class="excluded"><code>from people.models import Person</code></li>
<li class="ignored"><code></code></li>
<li class="ignored"><code># Import other libraries</code></li>
<li class="excluded"><code>import calendar as cal</code></li>
<li class="excluded"><code>from datetime import date, datetime</code></li>
<li class="excluded"><code>from decimal import Decimal</code></li>
<li class="ignored"><code></code></li>
<li class="executed"><code>class Sector(models.Model):</code></li>
<li class="ignored"><code>    """</code></li>
<li class="ignored"><code>    Used for industry information.</code></li>
<li class="ignored"><code>    Represents the GICS classification system.</code></li>
<li class="ignored"><code>    """</code></li>
<li class="ignored"><code></code></li>
<li class="executed"><code>    name = models.CharField(max_length=255)</code></li>
<li class="executed"><code>    symbol = models.CharField(max_length=2, unique=True)</code></li>
<li class="executed"><code>    description = models.TextField(blank=True)</code></li>
<li class="executed"><code>    custom = models.BooleanField(default=False, help_text="True if created by user (or otherwise customized)")</code></li>
<li class="ignored"><code></code></li>
<li class="executed"><code>    class Meta:</code></li>
<li class="executed"><code>        verbose_name_plural = 'GICS 1 Sectors'</code></li>
<li class="executed"><code>        verbose_name = 'GICS 1 Sector'</code></li>
<li class="executed"><code>        ordering = ['symbol', 'name', ]</code></li>
<li class="ignored"><code></code></li>
<li class="excluded"><code>    def __unicode__(self):</code></li>
<li class="excluded"><code>        return u'%s (%s)' % (unicode(self.name), unicode(self.symbol) )</code></li>
<li class="ignored"><code></code></li>
<li class="ignored"><code></code></li>
<li class="ignored"><code></code></li>
<li class="ignored"><code></code></li>
<li class="ignored"><code></code></li>
<li class="executed"><code>class IndustryGroup(models.Model):</code></li>
<li class="ignored"><code>    """</code></li>
<li class="ignored"><code>    Used for industry information. Represents the GICS</code></li>
<li class="ignored"><code>    classification system.</code></li>
<li class="ignored"><code>    """</code></li>
<li class="ignored"><code></code></li>
<li class="executed"><code>    name = models.CharField(max_length=255)</code></li>
<li class="executed"><code>    symbol = models.CharField(max_length=4, unique=True)</code></li>
<li class="executed"><code>    description = models.TextField(blank=True)</code></li>
<li class="executed"><code>    sector = models.ForeignKey(Sector)</code></li>
<li class="executed"><code>    custom = models.BooleanField(default=False, help_text="True if created by user (or otherwise customized)")</code></li>
<li class="ignored"><code></code></li>
<li class="executed"><code>    class Meta:</code></li>
<li class="executed"><code>        verbose_name_plural = 'GICS 2 Industry Groups'</code></li>
<li class="executed"><code>        verbose_name = 'GICS 2 Industry Group'</code></li>
<li class="executed"><code>        ordering = ['symbol', 'name', ]</code></li>
<li class="ignored"><code></code></li>
<li class="excluded"><code>    def __unicode__(self):</code></li>
<li class="excluded"><code>        return u'%s (%s)' % (unicode(self.name), unicode(self.symbol) )</code></li>
<li class="ignored"><code></code></li>
<li class="ignored"><code></code></li>
<li class="ignored"><code></code></li>
<li class="ignored"><code></code></li>
<li class="executed"><code>class Industry(models.Model):</code></li>
<li class="ignored"><code>    """</code></li>
<li class="ignored"><code>    Used for industry information. Represents the GICS</code></li>
<li class="ignored"><code>    classification system.</code></li>
<li class="ignored"><code>    """</code></li>
<li class="ignored"><code></code></li>
<li class="executed"><code>    name = models.CharField(max_length=255)</code></li>
<li class="executed"><code>    symbol = models.CharField(max_length=6, unique=True)</code></li>
<li class="executed"><code>    description = models.TextField(blank=True)</code></li>
<li class="executed"><code>    industry_group = models.ForeignKey(IndustryGroup)</code></li>
<li class="executed"><code>    sector = models.ForeignKey(Sector)</code></li>
<li class="executed"><code>    custom = models.BooleanField(default=False, help_text="True if created by user (or otherwise customized)")</code></li>
<li class="ignored"><code></code></li>
<li class="executed"><code>    class Meta:</code></li>
<li class="executed"><code>        verbose_name_plural = 'GICS 3 Industry'</code></li>
<li class="executed"><code>        verbose_name = 'GICS 3 Industry'</code></li>
<li class="executed"><code>        ordering = ['symbol', 'name', ]</code></li>
<li class="ignored"><code></code></li>
<li class="excluded"><code>    def __unicode__(self):</code></li>
<li class="excluded"><code>        return u'%s (%s)' % (unicode(self.name), unicode(self.symbol) )</code></li>
<li class="ignored"><code></code></li>
<li class="ignored"><code></code></li>
<li class="ignored"><code></code></li>
<li class="executed"><code>class SubIndustry(models.Model):</code></li>
<li class="ignored"><code>    """</code></li>
<li class="ignored"><code>    Used for industry information. Represents the GICS</code></li>
<li class="ignored"><code>    classification system.</code></li>
<li class="ignored"><code>    """</code></li>
<li class="ignored"><code></code></li>
<li class="executed"><code>    name = models.CharField(max_length=255)</code></li>
<li class="executed"><code>    symbol = models.CharField(max_length=8, unique=True)</code></li>
<li class="executed"><code>    description = models.TextField(blank=True)</code></li>
<li class="executed"><code>    industry = models.ForeignKey(Industry)</code></li>
<li class="executed"><code>    custom = models.BooleanField(default=False, help_text="True if created by user (or otherwise customized)")</code></li>
<li class="ignored"><code></code></li>
<li class="executed"><code>    class Meta:</code></li>
<li class="executed"><code>        verbose_name_plural = 'GICS 4 Sub-Industry'</code></li>
<li class="executed"><code>        verbose_name = 'GICS 4 Sub-Industry'</code></li>
<li class="executed"><code>        ordering = ['symbol', 'name', ]</code></li>
<li class="ignored"><code></code></li>
<li class="excluded"><code>    def __unicode__(self):</code></li>
<li class="excluded"><code>        return u'%s (%s)' % (unicode(self.name), unicode(self.symbol) )</code></li>
<li class="ignored"><code></code></li>
<li class="ignored"><code></code></li>
<li class="ignored"><code></code></li>
<li class="ignored"><code></code></li>
<li class="executed"><code>class Company(models.Model):</code></li>
<li class="ignored"><code>    """</code></li>
<li class="ignored"><code>    Represents a company.</code></li>
<li class="ignored"><code>    """</code></li>
<li class="ignored"><code></code></li>
<li class="executed"><code>    COMPANY_CHOICES = (</code></li>
<li class="ignored"><code>        (u'LTD', u'Limited Liability'),</code></li>
<li class="ignored"><code>        (u'P',   u'Partnership'),</code></li>
<li class="ignored"><code>        (u'SP',  u'Sole Proprietorship'),</code></li>
<li class="ignored"><code>        (u'NV',  u'Naamloze vennootschap'),</code></li>
<li class="ignored"><code>    )</code></li>
<li class="executed"><code>    company_type = models.CharField(max_length=255, choices=COMPANY_CHOICES)</code></li>
<li class="ignored"><code></code></li>
<li class="executed"><code>    STATUS_CHOICES = (</code></li>
<li class="ignored"><code>        (u'A', u'Active (Going Concern)'),</code></li>
<li class="ignored"><code>        (u'N', u'Active (Non-Going Concern)'),</code></li>
<li class="ignored"><code>        (u'D', u'Active (Developmental)'),</code></li>
<li class="ignored"><code>        (u'I', u'Inactive'),</code></li>
<li class="ignored"><code>        (u'U', u'Unknown'),</code></li>
<li class="ignored"><code>    )</code></li>
<li class="executed"><code>    status_type = models.CharField(max_length=1, choices=STATUS_CHOICES)</code></li>
<li class="ignored"><code></code></li>
<li class="ignored"><code>    # Company Details</code></li>
<li class="executed"><code>    name = models.CharField(max_length=255)</code></li>
<li class="executed"><code>    trade_name = models.CharField(max_length=255, blank=True, null=True)</code></li>
<li class="executed"><code>    short_name = models.CharField(max_length=15, blank=True, null=True, help_text="eg. Freddie Mac")</code></li>
<li class="executed"><code>    include_article_in_description = models.BooleanField(default=False, help_text="eg. [the] National Biscuit Company")</code></li>
<li class="executed"><code>    slug_name = models.CharField(max_length=255, unique=True)  # To do: change to slugfield</code></li>
<li class="executed"><code>    address = models.TextField(blank=True)</code></li>
<li class="executed"><code>    country = models.ForeignKey(Country, help_text="Country in which the company is registered" )</code></li>
<li class="executed"><code>    description = models.TextField(blank=True)</code></li>
<li class="executed"><code>    short_description = models.TextField(blank=True, validators=[MaxLengthValidator(370)])</code></li>
<li class="executed"><code>    phone = models.CharField(max_length=255, blank=True)</code></li>
<li class="executed"><code>    fax = models.CharField(max_length=255, blank=True)</code></li>
<li class="executed"><code>    website_url = models.URLField(blank=True)</code></li>
<li class="ignored"><code></code></li>
<li class="ignored"><code>    # Dates</code></li>
<li class="executed"><code>    registration_date = models.DateField(null=True, blank=True, help_text="Date founded")</code></li>
<li class="executed"><code>    latest_incorporation_date = models.DateField(null=True, blank=True, help_text="Incorporation date of latest incarnation")</code></li>
<li class="ignored"><code></code></li>
<li class="ignored"><code>    # Cache sectors</code></li>
<li class="executed"><code>    sub_industry = models.ForeignKey(SubIndustry)</code></li>
<li class="executed"><code>    industry = models.ForeignKey(Industry, blank=True, null=True, editable=False)</code></li>
<li class="executed"><code>    industry_group = models.ForeignKey(IndustryGroup, blank=True, null=True, editable=False)</code></li>
<li class="executed"><code>    sector = models.ForeignKey(Sector, blank=True, null=True, editable=False)</code></li>
<li class="ignored"><code></code></li>
<li class="ignored"><code>    # Cache sector names</code></li>
<li class="executed"><code>    sub_industry_name = models.CharField(max_length=255, blank=True, null=True, editable=False)</code></li>
<li class="executed"><code>    industry_name = models.CharField(max_length=255, blank=True, null=True, editable=False)</code></li>
<li class="executed"><code>    industry_group_name = models.CharField(max_length=255, blank=True, null=True, editable=False)</code></li>
<li class="executed"><code>    sector_name = models.CharField(max_length=255, blank=True, null=True, editable=False)</code></li>
<li class="ignored"><code></code></li>
<li class="ignored"><code>    # Financial Statements</code></li>
<li class="executed"><code>    financial_year_end = models.DateField(null=True, blank=True)</code></li>
<li class="executed"><code>    FP_CHOICES = (</code></li>
<li class="ignored"><code>        (u'A', u'Annual'),</code></li>
<li class="ignored"><code>        (u'S', u'Semi-Annual'),</code></li>
<li class="ignored"><code>        (u'Q', u'Quarterly'),</code></li>
<li class="ignored"><code>        (u'U', u'Unknown'),</code></li>
<li class="ignored"><code>    )</code></li>
<li class="executed"><code>    financial_publication_frequency = models.CharField(max_length=1, choices=FP_CHOICES, default="U", help_text='How often does this company produce financial statements?')</code></li>
<li class="ignored"><code></code></li>
<li class="ignored"><code>    # Special company flags</code></li>
<li class="executed"><code>    is_auditor = models.BooleanField(default = False, help_text='Is this company an Auditor, eg. PwC, Deloitte, etc.?.')</code></li>
<li class="executed"><code>    is_credit_rating_agency = models.BooleanField(default = False, help_text='is this company a credit rating agency, eg. S&amp;P, Fitch, etc.')</code></li>
<li class="executed"><code>    is_government_agency = models.BooleanField(default = False, help_text='Is this company a govermenet agency?')</code></li>
<li class="executed"><code>    is_non_profit = models.BooleanField(default = False, help_text='Is this a non-profit company?')</code></li>
<li class="executed"><code>    is_government = models.BooleanField(default = False, help_text='Is this a government?')</code></li>
<li class="executed"><code>    is_fund = models.BooleanField(default = False, help_text='Is this a Mutual Fund?')</code></li>
<li class="ignored"><code></code></li>
<li class="executed"><code>    class Meta:</code></li>
<li class="executed"><code>        verbose_name_plural = 'Companies'</code></li>
<li class="executed"><code>        verbose_name = 'Company'</code></li>
<li class="executed"><code>        ordering = ['name', ]</code></li>
<li class="executed"><code>        unique_together = ("name", "country")</code></li>
<li class="ignored"><code></code></li>
<li class="excluded"><code>    def __unicode__(self):</code></li>
<li class="excluded"><code>        return u'%s' % (unicode(self.name),)# ' ID: ' + unicode(self.id))</code></li>
<li class="ignored"><code></code></li>
<li class="excluded"><code>    def get_absolute_url(self):</code></li>
<li class="excluded"><code>        if not self.is_government and self.primary_stock_url != None:</code></li>
<li class="excluded"><code>            return self.primary_stock_url</code></li>
<li class="excluded"><code>        else:</code></li>
<li class="excluded"><code>            return None</code></li>
<li class="ignored"><code></code></li>
<li class="ignored"><code></code></li>
<li class="ignored"><code></code></li>
<li class="ignored"><code></code></li>
<li class="executed"><code>    def get_all_children(self, include_self=False):</code></li>
<li class="ignored"><code>        """</code></li>
<li class="ignored"><code>        Return all subsidiaries of this company.</code></li>
<li class="ignored"><code>        """</code></li>
<li class="missed"><code>        ownership = Ownership.objects.filter(parent=self)</code></li>
<li class="missed"><code>        subsidiaries = Company.objects.filter(child__in=ownership)</code></li>
<li class="missed"><code>        for sub in subsidiaries:</code></li>
<li class="missed"><code>            subsidiaries = subsidiaries | sub.get_all_children()</code></li>
<li class="ignored"><code></code></li>
<li class="missed"><code>	if include_self == True:</code></li>
<li class="missed"><code>	    self_company = Company.objects.filter(id=self.id)</code></li>
<li class="missed"><code>	    subsidiaries = subsidiaries | self_company</code></li>
<li class="missed"><code>        return subsidiaries</code></li>
<li class="ignored"><code></code></li>
<li class="executed"><code>    def get_all_parents(self):</code></li>
<li class="ignored"><code>        """</code></li>
<li class="ignored"><code>        Return all parents of this company.</code></li>
<li class="ignored"><code>        """</code></li>
<li class="missed"><code>        ownership = Ownership.objects.filter(child=self)</code></li>
<li class="missed"><code>        parents = Company.objects.filter(parent__in=ownership)</code></li>
<li class="missed"><code>        for parent in parents:</code></li>
<li class="missed"><code>            parents = parents | parent.get_all_parents()</code></li>
<li class="missed"><code>        return parents</code></li>
<li class="ignored"><code></code></li>
<li class="executed"><code>    def get_all_related_companies(self, include_self=False):</code></li>
<li class="ignored"><code>            """</code></li>
<li class="ignored"><code>            Return all parents and subsidiaries of the company</code></li>
<li class="ignored"><code>            Include the company if include_self = True</code></li>
<li class="ignored"><code>            """</code></li>
<li class="missed"><code>            parents = self.get_all_parents()</code></li>
<li class="missed"><code>            subsidiaries = self.get_all_children()</code></li>
<li class="missed"><code>            related_companies = parents | subsidiaries</code></li>
<li class="ignored"><code></code></li>
<li class="missed"><code>            if include_self == True:</code></li>
<li class="missed"><code>                company_qs = Company.objects.filter(id=self.id)</code></li>
<li class="missed"><code>                related_companies = related_companies | company_qs</code></li>
<li class="ignored"><code></code></li>
<li class="missed"><code>	    related_companies_ids = [ company.id for company in list(set(related_companies))]</code></li>
<li class="missed"><code>	    related_companies = Company.objects.filter(id__in=related_companies_ids)</code></li>
<li class="missed"><code>            return related_companies</code></li>
<li class="ignored"><code></code></li>
<li class="executed"><code>    def get_immediate_children(self):</code></li>
<li class="ignored"><code>        """</code></li>
<li class="ignored"><code>        Return all direct subsidiaries of this company.</code></li>
<li class="ignored"><code>        Excludes subsidiaries of subsidiaries</code></li>
<li class="ignored"><code>        """</code></li>
<li class="missed"><code>        ownership = Ownership.objects.filter(parent=self)</code></li>
<li class="missed"><code>        subsidiaries = Company.objects.filter(child__in=ownership).distinct()</code></li>
<li class="missed"><code>        return subsidiaries</code></li>
<li class="ignored"><code></code></li>
<li class="executed"><code>    def get_immediate_children_ownership(self):</code></li>
<li class="ignored"><code>        """</code></li>
<li class="ignored"><code>        Return all direct subsidiaries of this company AS OWNERSHIP OBJECTS.</code></li>
<li class="ignored"><code>        Excludes subsidiaries of subsidiaries.</code></li>
<li class="ignored"><code></code></li>
<li class="ignored"><code>        """</code></li>
<li class="missed"><code>        ownership = Ownership.objects.filter(parent=self).select_related('child', 'child__country')</code></li>
<li class="missed"><code>        return ownership</code></li>
<li class="ignored"><code></code></li>
<li class="executed"><code>    def get_immediate_parents(self):</code></li>
<li class="ignored"><code>        """</code></li>
<li class="ignored"><code>        Return all direct parents of this company. Excludes parents of parents</code></li>
<li class="ignored"><code>        """</code></li>
<li class="missed"><code>        ownership = Ownership.objects.filter(child=self)</code></li>
<li class="missed"><code>        parents = Company.objects.filter(parent__in=ownership).distinct()</code></li>
<li class="missed"><code>        return parents</code></li>
<li class="ignored"><code></code></li>
<li class="executed"><code>    def get_directors(self):</code></li>
<li class="ignored"><code>        """</code></li>
<li class="ignored"><code>        Return all directors for this company</code></li>
<li class="ignored"><code>        """</code></li>
<li class="missed"><code>        directors = Director.objects.filter(company=self, is_current=True).select_related('person')</code></li>
<li class="missed"><code>        return directors</code></li>
<li class="ignored"><code></code></li>
<li class="executed"><code>    def get_stocks(self):</code></li>
<li class="ignored"><code>        """</code></li>
<li class="ignored"><code>        Return all stocks for this company</code></li>
<li class="ignored"><code>        """</code></li>
<li class="missed"><code>        stocks = Stock.objects.filter(company=self)</code></li>
<li class="missed"><code>        return stocks</code></li>
<li class="ignored"><code></code></li>
<li class="executed"><code>    def get_latest_annual_financials(self):</code></li>
<li class="ignored"><code>        """</code></li>
<li class="ignored"><code>        Returns the latest annual financial statement model.</code></li>
<li class="ignored"><code>        """</code></li>
<li class="missed"><code>        try:</code></li>
<li class="missed"><code>            statement = FinancialStatement.objects.filter(company=self, statement_type="A").latest()</code></li>
<li class="missed"><code>        except FinancialStatement.DoesNotExist:</code></li>
<li class="missed"><code>            statement = None</code></li>
<li class="missed"><code>        return statement</code></li>
<li class="ignored"><code></code></li>
<li class="executed"><code>    def get_latest_financials(self):</code></li>
<li class="ignored"><code>        """</code></li>
<li class="ignored"><code>        Returns the latest financial statement model (interim or annual).</code></li>
<li class="ignored"><code>        """</code></li>
<li class="missed"><code>        try:</code></li>
<li class="missed"><code>            statement = FinancialStatement.objects.filter(company=self).latest()</code></li>
<li class="missed"><code>        except FinancialStatement.DoesNotExist:</code></li>
<li class="missed"><code>            statement = None</code></li>
<li class="missed"><code>        return statement</code></li>
<li class="ignored"><code></code></li>
<li class="ignored"><code></code></li>
<li class="ignored"><code></code></li>
<li class="executed"><code>    def cache_data(self):</code></li>
<li class="ignored"><code>        """</code></li>
<li class="ignored"><code>        Cache some basic data such as financial statement metrics</code></li>
<li class="ignored"><code>        """</code></li>
<li class="ignored"><code></code></li>
<li class="ignored"><code></code></li>
<li class="ignored"><code></code></li>
<li class="ignored"><code>        # Set Slug if not set</code></li>
<li class="missed"><code>        if not self.slug_name:</code></li>
<li class="missed"><code>            self.slug_name=slugify(self.name).strip()</code></li>
<li class="missed"><code>            if len(self.slug_name) &gt; 255:</code></li>
<li class="missed"><code>                self.slug_name = self.slug_name[0:254]</code></li>
<li class="ignored"><code></code></li>
<li class="executed"><code>    def get_name_on_date(self, date):</code></li>
<li class="ignored"><code>	"""</code></li>
<li class="ignored"><code>	Get the name of a company on a given date. Accounts for</code></li>
<li class="ignored"><code>	name changes that may have occurred.</code></li>
<li class="ignored"><code>	"""</code></li>
<li class="missed"><code>	if date == None:</code></li>
<li class="missed"><code>	    return self.name</code></li>
<li class="ignored"><code></code></li>
<li class="missed"><code>	post_name_changes = CompanyNameChange.objects.filter(company=self,</code></li>
<li class="ignored"><code>                                                             date__gte=date).order_by('date')</code></li>
<li class="missed"><code>	if post_name_changes.count() == 0:</code></li>
<li class="missed"><code>	    return self.name</code></li>
<li class="ignored"><code>	else:</code></li>
<li class="missed"><code>	    return post_name_changes[0].name_before</code></li>
<li class="ignored"><code></code></li>
<li class="executed"><code>    def save(self, *args, **kwargs):</code></li>
<li class="ignored"><code>        """</code></li>
<li class="ignored"><code>        This method autogenerates the auto_generated_description field</code></li>
<li class="ignored"><code>        """</code></li>
<li class="ignored"><code></code></li>
<li class="ignored"><code>        # Cache basic data</code></li>
<li class="missed"><code>        self.cache_data()</code></li>
<li class="ignored"><code></code></li>
<li class="missed"><code>	if str(self.trade_name).strip() == "":</code></li>
<li class="missed"><code>	    self.trade_name = None</code></li>
<li class="ignored"><code></code></li>
<li class="ignored"><code>	# Short description check</code></li>
<li class="missed"><code>	if len(str(self.short_description)) &gt; 370:</code></li>
<li class="excluded"><code>	    raise AssertionError("Short description must be no more than 370 characters")</code></li>
<li class="ignored"><code></code></li>
<li class="ignored"><code></code></li>
<li class="missed"><code>        if self.sub_industry != None:</code></li>
<li class="ignored"><code>            # Cache GICS</code></li>
<li class="missed"><code>            self.industry = self.sub_industry.industry</code></li>
<li class="missed"><code>            self.industry_group = self.sub_industry.industry.industry_group</code></li>
<li class="missed"><code>            self.sector = self.sub_industry.industry.industry_group.sector</code></li>
<li class="ignored"><code>            # Cache GICS names</code></li>
<li class="missed"><code>            self.sub_industry_name = self.sub_industry.name</code></li>
<li class="missed"><code>            self.industry_name = self.industry.name</code></li>
<li class="missed"><code>            self.industry_group_name = self.industry_group.name</code></li>
<li class="missed"><code>            self.sector_name = self.sector.name</code></li>
<li class="ignored"><code></code></li>
<li class="ignored"><code></code></li>
<li class="ignored"><code></code></li>
<li class="ignored"><code>        # Call save method</code></li>
<li class="missed"><code>        super(Company, self).save(*args, **kwargs) # Call the "real" save() method.</code></li>
<li class="ignored"><code></code></li>
<li class="ignored"><code></code></li>
<li class="executed"><code>class CompanyNameChange(models.Model):</code></li>
<li class="ignored"><code>    """</code></li>
<li class="ignored"><code>    Represents a company name change</code></li>
<li class="ignored"><code>    """</code></li>
<li class="ignored"><code></code></li>
<li class="executed"><code>    date = models.DateField()</code></li>
<li class="executed"><code>    name_before = models.CharField(max_length=255)</code></li>
<li class="executed"><code>    name_after = models.CharField(max_length=255)</code></li>
<li class="ignored"><code></code></li>
<li class="executed"><code>    short_description = models.CharField(max_length=85)</code></li>
<li class="executed"><code>    long_description = models.CharField(max_length=255)</code></li>
<li class="executed"><code>    company = models.ForeignKey(Company)</code></li>
<li class="ignored"><code></code></li>
<li class="executed"><code>    STATUS_CHOICES = (</code></li>
<li class="ignored"><code>    ("CO",    u'Completed'),</code></li>
<li class="ignored"><code>    ("FA",    u'Failed'),</code></li>
<li class="ignored"><code>    ("UP",    u'Upcoming'),</code></li>
<li class="ignored"><code>    )</code></li>
<li class="executed"><code>    status = models.CharField(max_length=2, choices=STATUS_CHOICES, default="CO")</code></li>
<li class="ignored"><code></code></li>
<li class="executed"><code>    class Meta:</code></li>
<li class="executed"><code>	verbose_name_plural = 'Company Name Changes'</code></li>
<li class="executed"><code>	verbose_name = 'Company Name Change'</code></li>
<li class="executed"><code>	ordering = ['date']</code></li>
<li class="executed"><code>	unique_together = ("company", 'date')</code></li>
<li class="ignored"><code></code></li>
<li class="excluded"><code>    def __unicode__(self):</code></li>
<li class="excluded"><code>	return u'%s, %s' % (unicode(self.company),</code></li>
<li class="ignored"><code>                            unicode(self.date))</code></li>
<li class="ignored"><code></code></li>
<li class="ignored"><code></code></li>
<li class="executed"><code>class Ownership(models.Model):</code></li>
<li class="ignored"><code>    """</code></li>
<li class="ignored"><code>    Represents an ownership mapping of a company. That is, this class maps a parent/owner</code></li>
<li class="ignored"><code>    to a subsidiary.</code></li>
<li class="ignored"><code>    """</code></li>
<li class="ignored"><code></code></li>
<li class="executed"><code>    name = models.CharField(max_length=255, blank=True, null=True, editable=False)  # This will speed up the admin</code></li>
<li class="executed"><code>    parent = models.ForeignKey(Company, related_name='parent')</code></li>
<li class="executed"><code>    child = models.ForeignKey(Company, related_name='child')</code></li>
<li class="executed"><code>    amount = models.DecimalField(max_digits=5, decimal_places=2, null=True, blank=True)</code></li>
<li class="ignored"><code></code></li>
<li class="executed"><code>    OWNERSHIP_TYPE = (</code></li>
<li class="ignored"><code>        (u'SUB', u'Subsidiary'),</code></li>
<li class="ignored"><code>        (u'ASS', u'Associate'),</code></li>
<li class="ignored"><code>        (u'JV',  u'Joint Venture'),</code></li>
<li class="ignored"><code>        (u'I',   u'Institutional'),</code></li>
<li class="ignored"><code>    )</code></li>
<li class="executed"><code>    ownership_type = models.CharField(max_length=3, choices=OWNERSHIP_TYPE)</code></li>
<li class="ignored"><code></code></li>
<li class="executed"><code>    class Meta:</code></li>
<li class="executed"><code>	verbose_name_plural = 'Ownership'</code></li>
<li class="executed"><code>	verbose_name = 'Ownership'</code></li>
<li class="executed"><code>	ordering = ['parent', 'child' ]</code></li>
<li class="executed"><code>	unique_together = ("parent", "child")</code></li>
<li class="ignored"><code></code></li>
<li class="excluded"><code>    def __unicode__(self):</code></li>
<li class="excluded"><code>	return u'%s - (%s%%)' % (unicode(self.name), unicode(self.amount))</code></li>
<li class="ignored"><code></code></li>
<li class="executed"><code>    def save(self, *args, **kwargs):</code></li>
<li class="ignored"><code>	"""</code></li>
<li class="ignored"><code>	Generate a name, and ensure amount is less than or equal to 100</code></li>
<li class="ignored"><code>	"""</code></li>
<li class="ignored"><code></code></li>
<li class="missed"><code>	self.name = str(self.parent.name) + "   -   " + str(self.child.name) + "  -  " + str(self.ownership_type)</code></li>
<li class="ignored"><code></code></li>
<li class="missed"><code>	if self.amount &gt; 100:</code></li>
<li class="missed"><code>	    raise IntegrityError("Ownership amount cannot be more than 100%")</code></li>
<li class="missed"><code>	elif self.amount &lt; 0:</code></li>
<li class="missed"><code>	    raise IntegrityError("Ownership amount cannot be less than 0%")</code></li>
<li class="ignored"><code>	else:</code></li>
<li class="missed"><code>	    super(Ownership, self).save(*args, **kwargs) # Call the "real" save() method.</code></li>
<li class="ignored"><code></code></li>
<li class="ignored"><code></code></li>
<li class="ignored"><code></code></li>
<li class="ignored"><code></code></li>
<li class="ignored"><code></code></li>
<li class="executed"><code>class Director(models.Model):</code></li>
<li class="ignored"><code>    """</code></li>
<li class="ignored"><code>    Represents each member of a company's board of directors.</code></li>
<li class="ignored"><code>    """</code></li>
<li class="ignored"><code></code></li>
<li class="executed"><code>    name = models.CharField(max_length=255, blank=True, null=True)  # This will speed up the admin</code></li>
<li class="executed"><code>    company = models.ForeignKey(Company)</code></li>
<li class="executed"><code>    person = models.ForeignKey(Person)</code></li>
<li class="executed"><code>    start_date = models.DateField(null=True, blank=True)</code></li>
<li class="executed"><code>    end_date = models.DateField(null=True, blank=True)</code></li>
<li class="executed"><code>    is_current = models.BooleanField(default=True)</code></li>
<li class="executed"><code>    position = models.CharField(max_length=255, blank=True)</code></li>
<li class="ignored"><code></code></li>
<li class="executed"><code>    class Meta:</code></li>
<li class="executed"><code>	verbose_name_plural = 'Directors'</code></li>
<li class="executed"><code>	verbose_name = 'Director'</code></li>
<li class="executed"><code>	ordering = ['is_current', 'company', 'person', ]</code></li>
<li class="executed"><code>	unique_together = ("company", "person", "start_date", "end_date")</code></li>
<li class="ignored"><code></code></li>
<li class="ignored"><code></code></li>
<li class="excluded"><code>    def __unicode__(self):</code></li>
<li class="excluded"><code>	return u'%s' % (unicode(self.name))</code></li>
<li class="ignored"><code></code></li>
<li class="executed"><code>    def tenure(self):</code></li>
<li class="ignored"><code>	"""</code></li>
<li class="ignored"><code>	Calculates board tenure in years</code></li>
<li class="ignored"><code>	"""</code></li>
<li class="missed"><code>	if self.end_date:</code></li>
<li class="missed"><code>	    return round((date.end_date - self.start_date).days / 365., 2)</code></li>
<li class="ignored"><code>	else:</code></li>
<li class="missed"><code>	    return round((date.today() - self.start_date).days / 365., 2)</code></li>
<li class="ignored"><code></code></li>
<li class="executed"><code>    def save(self, *args, **kwargs):</code></li>
<li class="ignored"><code>	"""</code></li>
<li class="ignored"><code>	Save the person model so it updates his/her number of board connections field.</code></li>
<li class="ignored"><code>	Also updates name</code></li>
<li class="ignored"><code>	"""</code></li>
<li class="ignored"><code></code></li>
<li class="missed"><code>	self.name = str(self.company.name) + "   ---   " + str(self.person)</code></li>
<li class="missed"><code>	super(Director, self).save(*args, **kwargs) # Call the "real" save() method.</code></li>
<li class="missed"><code>	other_directors = Director.objects.filter(company=self.company)</code></li>
<li class="missed"><code>	for director in other_directors:</code></li>
<li class="missed"><code>	    director.person.save()</code></li>
<li class="ignored"><code></code></li>
<li class="ignored"><code></code></li>
<li class="ignored"><code></code></li>
<li class="executed"><code>class Executive(models.Model):</code></li>
<li class="ignored"><code>    """</code></li>
<li class="ignored"><code>    Represents each member of a company's executive team (i.e. management).</code></li>
<li class="ignored"><code>    """</code></li>
<li class="ignored"><code></code></li>
<li class="executed"><code>    name = models.CharField(max_length=255, blank=True, null=True)  # This will speed up the admin</code></li>
<li class="executed"><code>    company = models.ForeignKey(Company)</code></li>
<li class="executed"><code>    person = models.ForeignKey(Person)</code></li>
<li class="executed"><code>    start_date = models.DateField(null=True, blank=True)</code></li>
<li class="executed"><code>    end_date = models.DateField(null=True, blank=True)</code></li>
<li class="executed"><code>    is_current = models.BooleanField(default=True)</code></li>
<li class="executed"><code>    position = models.CharField(max_length=255, blank=True)</code></li>
<li class="ignored"><code></code></li>
<li class="executed"><code>    class Meta:</code></li>
<li class="executed"><code>	verbose_name_plural = 'Executives'</code></li>
<li class="executed"><code>	verbose_name = 'Executive'</code></li>
<li class="executed"><code>	ordering = ['is_current', 'company', 'person', ]</code></li>
<li class="ignored"><code></code></li>
<li class="excluded"><code>    def __unicode__(self):</code></li>
<li class="excluded"><code>	return u'%s' % (unicode(self.name))</code></li>
<li class="ignored"><code></code></li>
<li class="executed"><code>    def save(self, *args, **kwargs):</code></li>
<li class="ignored"><code>	"""</code></li>
<li class="ignored"><code>	Updates name</code></li>
<li class="ignored"><code>	"""</code></li>
<li class="ignored"><code></code></li>
<li class="missed"><code>	self.name = str(self.company.name) + "   ---   " + str(self.person)</code></li>
<li class="missed"><code>	super(Executive, self).save(*args, **kwargs) # Call the "real" save() method.</code></li>
<li class="ignored"><code></code></li>
<li class="ignored"><code></code></li>
<li class="ignored"><code></code></li>
<li class="ignored"><code></code></li>
  </ol>
</div>

<div class="nav">
  <a href="companies.__init__.html">companies.__init__</a> &lt;&lt;
  <a href="../index.html">index</a>
</div>

  </body>
</html>

